\documentclass[a4paper,10pt]{article}
\usepackage[
        a4paper,% other options: a3paper, a5paper, etc
        left=3cm,
        right=3cm,
        top=3cm,
        bottom=4cm,
        % use vmargin=2cm to make vertical margins equal to 2cm.
        % us  hmargin=3cm to make horizontal margins equal to 3cm.
        % use margin=3cm to make all margins  equal to 3cm.
]{geometry}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{tikz}
\usepackage{listings}
\usepackage[scaled=.85]{sourcecodepro}
\usepackage{color}
\usepackage{comment}
\usepackage{bbold}

% Used for converting html to latex
\usepackage{html,makeidx}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}


\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{blue},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\small\ttfamily,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}
\title{Forehead Idiot\\ {\Large Multi Agent Systems}}
\author{Jos van de Wolfshaar (s2098407)\\
Siebert Looije\\
Diederik Greveling} 
\date{\today}

\begin{document}
\maketitle
\section{General Kripke structure}
\subsection{Kripke model}
For modeling Forehead idiot we consider the structures $M = \langle S, \pi, R \rangle$. We consider the games for 3 players. The states are given by $\boldsymbol s = (s_1,s_2,\ldots,s_m) \in S$, where $s_i \in D = \{ 2,3,4,5,6,7,8,9,10,j,q,k,a \}$. This means that if $s_3 = 5$, then player 3 has 5 on his forehead. Note that $D$ is an ordered set:
$2<3<4<5<6<7<8<9<10<j<q<k<a$.

Since any player can only see those cards that are on the forehead of the other players, the relations are defined as $\boldsymbol s R_i \boldsymbol t$ such that $s_j = t_j,~\forall j \neq i$. A player's card is unique: $s_1 \neq s_2 \neq \cdots \neq s_m$. Note that relations are symmetric and reflexive.

Suppose we take a subset of the total deck $D'\subseteq D$ with $|D'|=n$. There are $n!$ different sequences of cards. If the number of players is $m\leq n$, then for each possible set of cards there will be $(n-m)!$ games with the same sequence of cards for the first $m$ cards. Hence, the total number of possible games $g$ is:
\begin{equation}
 g=\frac{n!}{(n-m)!}
\end{equation}

The propositions in our model will be given by $\boldsymbol P = \{ p_ic_2,p_ic_3,\ldots,p_ic_a,w_i,l_i\}_{i=1}^m$. For example, $p_2 c_7$ means that player 2 holds card 7. The proposition $w_i$ means that player $i$ wins the game, whereas $l_i$ means that player $i$ loses the game.

The valuation will be as follows:
\begin{itemize}
 \item We have that $\pi(\boldsymbol s)(p_ic_j) = \mathbb{t}$ iff $s_i = j$, so $\pi(\boldsymbol s)(p_ic_j) = \mathbb{f}$ iff $s_i \neq j$. 
 \item Furthermore, we have $\pi(\boldsymbol s)(w_i) = \mathbb{t}$ and $\pi(\boldsymbol s)(l_i) = \mathbb{f}$ iff $s_i > s_j$ for all $j \neq i$. In other words, $\pi(\boldsymbol s)(w_i)=\mathbb{f}$ and $\pi(\boldsymbol s)(l_i) = \mathbb{t}$ if for some $j\neq i$ we have that $s_i < s_j$. 
\end{itemize}

\subsection{Theory}
Before the cards are put on the foreheads, every player knows that every player has exactly one card. This can be captured by
\begin{align*}
 K_i \bigwedge_{j=1}^m \bigg((p_j c_2 \wedge \neg p_j c_3 \wedge \cdots \wedge \neg p_j c_a) \vee (\neg p_j c_2 \wedge p_j c_3 \wedge \cdots \wedge \neg p_j c_a) \vee \cdots \vee (\neg p_j c_2 \wedge \neg p_j c_3 \wedge \cdots \wedge p_j c_a) \bigg)
\end{align*}

The moment that the players put the cards on their foreheads it is as if $m$ announcements are made. Every player announces that he knows what the other players' cards are (without actually saying it). This means that every player also knows his remaining possibilities.

In the most general case, we could express this as follows:
\begin{align*}
 M \models \left[ \bigwedge_{i=1}^m K_i \left(\bigwedge_{j\neq i} p_j c_{u^{(j)}} \right) \right] \bigwedge_{i=1}^m \left( K_i \bigvee_{u^{(i)} \notin \{ u^{(j)} \}_{j\neq i}} p_i c_{u^{(i)}} \right)
\end{align*}
where $u^{(j)} \in D'$ is the card that player $j$ is holding. This greatly reduces the number of possible worlds. In fact, if there are $n$ cards and $m$ players, we have that each player has $n-m+1$ alternative worlds. Hence there are $m(n-m+1) - m +1$ possible worlds left. 


\section{Game analysis}
\subsection{$n$ cards game with $m=n$ players}
In the scenario of $n$ cards with $m=n$ players there will be $\displaystyle g = \frac{n!}{(n-m)!} = n!$ possible games. Once the cards are dealt, each player is able to see the other players' cards. Because of the fact that $m=n$ and the fact that all cards are unique, for any pair of states $\boldsymbol s, \boldsymbol t$ such that $\boldsymbol s \neq \boldsymbol t$, we have that at least two cards are changed: $s_i \neq t_i$ and $s_j \neq t_j$ for $i,j\leq m$ and $i\neq j$.

This implies that there are only reflexive relations: $\boldsymbol s R_i \boldsymbol s$, since for any other $\boldsymbol t \neq \boldsymbol s$, we require that all cards but one are the same. For any state $\boldsymbol s$ this relation is only satisfied by $\boldsymbol s$ itself.

Therefore, once a player sees the other players' cards, he will know his own card, since there is only one state to go to. Hence, each player knows whether he wins or loses. Therefore, from a game theoretic point of view, this scenario is not particularly interesting.

TODO: maybe formalize this more...

\subsection{$n$ cards with $m<n$ players}
A more difficult scenario arises when there are $n$ cards and $m < n$ players. In this case there are relations $\boldsymbol s R_i \boldsymbol t$ for those pairs of $\boldsymbol s$ and $\boldsymbol t$ such that $s_j = t_j$ for all $j\neq i$.

\subsubsection{The probability of winning the game}

\paragraph{Estimating one's own odds}
Since there are $n-m$ cards that have not been dealt, each player has $n-m+1$ possibilities for his own card and, consequently, $n-m+1$ possible outcomes of the game. To determine the probability for a player to win, let $T_i \subseteq S$ be the subset of possible states such that $\boldsymbol s R_i \boldsymbol t$. Note that $|T_i| = n-m+1$. Now let $T^{(w_i)}_i \subseteq T_i$ be a subset of states such that for $\boldsymbol t \in T^{(w_i)}_i$ we have that $(M,\boldsymbol t) \models w_i$. The probability that player $i$ wins based on the information available is:
\begin{equation}
\mathcal{P}^{(w_i)}_i = \frac{|T^{(w_i)}_i|}{|T_i|} = \frac{\lvert T^{(w_i)}_i\rvert}{n-m+1}
\end{equation}

The relations are symmetric. Hence, $\mathcal{P}^{(w_i)}_i$ will be the same for all states.

\paragraph{Estimating another player's odds}
Let $T^{(w_j)}_i \subseteq T_i$ be the subset of states such that for all states $\boldsymbol t \in T^{(w_j)}_i$ we have that $(M,\boldsymbol t) \models w_j$. Based on this information and perhaps not surprisingly, the probability for player $j$ to win this game from player $i$'s point of view will be given by:
\begin{equation}
\mathcal{P}^{(w_j)}_i = \frac{|T^{(w_j)}_i|}{|T_i|} = \frac{\lvert T^{(w_j)}_i\rvert}{n-m+1} \label{eq:prob}
\end{equation}


\subsubsection{Playing strategies}
\paragraph{Calling a bet}
Before we get to the optimal strategy, let us define the utility. If $\mathcal G^{(k)}_i$ denotes the `gain' of winning the game at round $k$, the utility will be given by:
\begin{equation}
 U^{(w_i)}_i = \mathcal G^{(k)}_i \mathcal P^{(w_i)}_i
\label{eq:util}
 \end{equation}
Let $\mathcal{L}^{(k)}_i$ be the loss of folding or losing the game after calling round $k$. In other words, $\mathcal L^{(k)}_i$ denotes the amount of coins that the player $i$ will have to bet for playing until round $k$. Note that $\displaystyle \mathcal G^{(k)}_i = \sum_{j\neq i} \mathcal L^{(k)}_j$. 

The utility of losing a game will be given by:
\begin{equation}
 U^{(l_i)}_i = -\mathcal L^{k}_i (1-\mathcal P^{(w_i)}_i)
\end{equation}

Now we can define a player's strategy for calling any bet as follows. Let $C_i^{(k)} \in \{\mathbb t, \mathbb f\}$ denote the decision of player $i$ at round $k$, where $\mathbb t$ corresponds to calling the bet and $\mathbb f$ corresponds to folding. The decision will be given by:
\begin{equation}
C_i^{(k)}  =
\begin{cases}
 \mathbb t & \text{if } \gamma_i U^{(w_i)}_i + U^{(l_i)}_i \geq 0\\
 \mathbb f & \text{otherwise}
\end{cases}
\label{eq:strat}
\end{equation}
In equation \ref{eq:strat}, $\gamma_i$ will characterize the player's characteristic strategy. If $\gamma_i = 1$, the player has an optimal strategy. If $\gamma_i > 1$ the player exhibits a risky strategy. If $\gamma_i < 1$ the player exhibits a safe strategy.

We can also decide to make the gain $\mathcal G^{(k)}_i$ a bit more specific:
\begin{equation}
\mathcal G^{(k)}_i = {\color{red} \sum_{j=1}^{i-1} \mathcal L^{(k)}_j} + {\color{blue} \sum_{j=i+1}^m \mathcal L^{(k-1)}_j} + {\color{magenta} \sum_{j=i+1}^m \{ C^{(k)}_j\} (\mathcal L^{(k)}_j - \mathcal L^{(k-1)}_j)}
\label{eq:gain}
\end{equation}
where we have the {\color{red} bet of all players hat have already called the current bet}, the {\color{blue} bet of all players that still have to call the current bet} and {\color{magenta} the bets that those players are going to place this round}. In this equation $\{C^{(k)}_j\} = 1$ if $C^{(k)}_j=\mathbb{t}$ and $\{C^{(k)}_j\} = 0$ otherwise.

It is interesting to see if we can let the players deduce the value of $\gamma_i$ for the other players. Until then, it seems reasonable to simplify equation (\ref{eq:gain}) to:
\begin{equation}
\mathcal{G}^{(k)}_i = \sum_{j\neq i} \mathcal L^{(k)}_j
\label{eq:sgain}
\end{equation}


\paragraph{Raising the current bet: bluffing}
A player can also decide to raise the current bet. The main reason for raising your bet is to make the other players decide to quit the game, or to increase the final gain. A player now bluffs if, after its bluffing bet, $\gamma_i U^{(w)}_i + U^{(l)}_i < 0$. 

Based on the information that is available, a player can estimate the utilities of other players. Hence, it can make its own estimations of the other players' gains: $\langle \mathcal G^{(k)}_j \rangle_i$, which is the estimated gain for player $j$ from player $i$'s point of view. 

The estimations can be obtained by using equations (\ref{eq:util}) through (\ref{eq:sgain}), but now we will start with some estimated probability $\mathcal P^{w_j}_i$, from equation (\ref{eq:prob}).

Once we have the estimated gains we can make an estimation of the other player's decisions. For bluffing we want to achieve that $C^{(k)}_j = \mathbb{f}$ for the players $j\neq i$. Hence, if a player decides to bluff, he should try to ensure that $\langle C^{(k)}_j \rangle_i = \mathbb{f}$ for those player's that have a higher probability of winning. Formally, it should make at least those players $j$ fold such that $\mathcal P^{(w_j)}_i > \mathcal P^{(w_i)}_i$. 

\paragraph{Raising the current bet: increasing the gain}
If a player is confident of winning the round, he can decide to raise the current bet. A player should try to accomplish that $C^{(k)}_j = \mathbb{t}$ while it should also maximize the expected gain. 

\begin{comment}
\begin{figure}[!h]
 \centering
\begin{tikzpicture}
  \node [mystate] (a) at (0,0) {$\bullet$};
  \node [mystate] (b) at (5,0) {$\bullet$};
  \draw (a) node[below] {$\neg p, q, \neg r$};
  \draw (b) node[below] {$p, q, r$};
  \draw (a) node[above] {$w_1$};
  \draw (b) node[above] {$w_2$};
  \draw (a) to node[below] {$b$} (b);
\end{tikzpicture}
\caption{Simple world}
\label{fig:wrld}
\end{figure}
\end{comment}



\end{document}
